<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Heatmap</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://d3js.org/d3-color.v2.min.js"></script>
    <script src="https://d3js.org/d3-interpolate.v2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.25.6/d3-legend.min.js"></script>
  </head>
  <body>
    <script>
      // set the dimensions and margins of the graph
      var margin = { top: 50, right: 120, bottom: 50, left: 150 },
        width = 800 - margin.left - margin.right,
        height = 600 - margin.top - margin.bottom;

      var svg = d3
        .select("body")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

      var gridSize = Math.floor(width / 24);
      var legendElementWidth = gridSize * 2;
      var buckets = 9;
      colors = [
        "#ffffd9",
        "#edf8b1",
        "#c7e9b4",
        "#7fcdbb",
        "#41b6c4",
        "#1d91c0",
        "#225ea8",
        "#253494",
        "#081d58",
      ];
      var years = [
        1935,
        1940,
        1945,
        1950,
        1955,
        1960,
        1965,
        1970,
        1975,
        1980,
        1985,
        1990,
        1995,
        2000,
        2005,
        2010,
        2015,
      ];

      var parseTime = d3.timeParse("%YYYY");

      d3.csv("Datasets/top_10.csv", function (d) {
        return {
          date: d3.timeParse("%Y")(d.Year),
          appearance: +d["APPEARANCES"],
          name: d["name"],
        };
      }).then(function (data) {
        //Adding the x scale and axis
        var xScale = d3
          .scaleTime()
          .domain(
            d3.extent(data, function (d) {
              return d.date;
            })
          )
          .range([0, width]);

        var xAxis = svg
          .append("g")
          .call(d3.axisBottom(xScale))
          .attr("transform", "translate(60,515)");

        var yScale = d3
          .scaleBand()
          .domain(
            data.map(function (d) {
              return d.name;
            })
          )
          .range([height, 0])
          .padding(0.1);

        var yAxis = svg
          .append("g")
          .call(d3.axisLeft(yScale))
          .attr("transform", "translate(40,0)");

        var colorScale = d3
          .scaleSequential(d3.interpolateReds)
          .domain(d3.extent(data, (d) => d.appearance));

        var cards = svg.selectAll(".hour").data(data, function (d) {
          return d.name + ":" + d.appearance;
        });

        cards.append("title");

        cards
          .enter()
          .append("rect")
          .attr("x", function (d) {
            return xScale(d.date) * gridSize;
          })
          .attr("y", function (d) {
            return yScale(d.name);
          })
          .attr("rx", 4)
          .attr("ry", 4)
          .attr("width", gridSize)
          .attr("height", yScale.bandwidth())
          .style("fill", (d) => colorScale(+d.appearance));
      });
    </script>
  </body>
</html>
